<script>
const params = new URLSearchParams(location.search);
const reporteId = params.get('id');

async function cargarGastos() {
  const { data } = await supabase
    .from('gastos')
    .select('*')
    .eq('reporte_id', reporteId);

  tablaGastos.innerHTML = '';
  data.forEach(g => {
    tablaGastos.innerHTML += `
      <tr>
        <td>${g.fecha}</td>
        <td>${g.proveedor}</td>
        <td>${g.categoria}</td>
        <td>${g.total}</td>
      </tr>`;
  });
}

procesar.onclick = async () => {
  const file = archivo.files[0];
  const datos = await leerComprobante(file);

  await supabase.from('gastos').insert({
    reporte_id: reporteId,
    fecha: datos.fecha || new Date().toISOString().slice(0,10),
    proveedor: datos.proveedor,
    categoria: datos.categoria,
    total: datos.total || 0
  });

  cargarGastos();
};

cargarGastos();
</script>
